"use strict";(function(){function t(t){switch(t){case 9:case 10:case 13:case 32:return!0;default:return!1}}function e(t){switch(t){case 9:case 10:case 13:case 32:case 91:case 93:case 123:case 125:case 58:case 44:return!1;default:return!0}}function s(t){switch(t){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 97:case 65:case 98:case 66:case 99:case 67:case 100:case 68:case 101:case 69:case 102:case 70:return!0;default:return!1}}function r(t){switch(t){case 46:case 43:case 61:return!0;default:return s(t)}}function o(t){return t>48&&56>t}function i(t){switch(t){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:case 65:return 10;case 98:case 66:return 11;case 99:case 67:return 12;case 100:case 68:return 13;case 101:case 69:return 14;case 102:case 70:return 15}}var a=this,h=a.hipack,n={};n.noConflict=function(){return a.hipack=h,n};var u=Object.keys,c=Array.isArray;n.DumpError=function(t){this.message=t,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack},n.Dumper=function(t){this.indent=t?-1:0,this.output=""},n.Dumper.prototype.moreIndent=function(){this.indent>=0&&this.indent++},n.Dumper.prototype.lessIndent=function(){this.indent>0&&this.indent--},n.Dumper.prototype.dumpIndent=function(){for(var t=this.indent>=0?this.indent:0;t--;)this.output+="  "},n.Dumper.prototype.dumpString=function(t){this.output+='"';for(var e=0;e<t.length;e++){var s=t.charCodeAt(e);switch(s){case 9:this.output+="\\t";break;case 10:this.output+="\\n";break;case 13:this.output+="\\r";break;case 34:this.output+='\\"';break;case 92:this.output+="\\\\";break;default:32>s?(this.output+="\\",16>s&&(this.output+="0"),this.output+=s.toString(16).toUpperCase()):this.output+=t.charAt(e)}}this.output+='"'},n.Dumper.prototype.dumpBoolean=function(t){this.output+=t?"True":"False"},n.Dumper.prototype.dumpNumber=function(t){this.output+=t.toString()},n.Dumper.prototype.dumpKeyVal=function(t,e){for(var s=0;s<e.length;s++){this.dumpIndent(),this.output+=e[s];var r=t[e[s]];"object"!=typeof r&&(this.output+=":"),this.indent>=0&&(this.output+=" "),this.dumpValue(r),this.indent>=0?this.output+="\n":s<e.length-1&&(this.output+=",")}},n.Dumper.prototype.dumpList=function(t){if(0==t.length)return void(this.output+="[]");this.output+="[",this.moreIndent(),this.indent>=0&&(this.output+="\n");for(var e=0;e<t.length;e++)this.dumpIndent(),this.dumpValue(t[e]),this.indent>=0?this.output+="\n":e<t.length-1&&(this.output+=",");this.lessIndent(),this.output+="]"},n.Dumper.prototype.dumpDict=function(t){var e=u(t);return 0==e.length?void(this.output+="{}"):(this.output+="{",this.moreIndent(),this.indent>=0&&(this.output+="\n"),this.dumpKeyVal(t,e.sort()),this.lessIndent(),this.dumpIndent(),void(this.output+="}"))},n.Dumper.prototype.dumpValue=function(t){var e=typeof t;switch(e){case"number":this.dumpNumber(t);break;case"boolean":this.dumpBoolean(t);break;case"string":this.dumpString(t);break;case"object":if(null!==t){c(t)?this.dumpList(t):this.dumpDict(t);break}e="null";default:throw new n.DumpError("Values of type '"+e+"' cannot be dumped")}},n.dump=function(t,e){var s=new n.Dumper(Boolean(e)),r=u(t);return s.dumpKeyVal(t,r.sort()),s.output};var p=-1,l=Number.parseInt,d=Number.parseFloat,k=String.fromCharCode;n.ParseError=function(t,e){this.message=e,this.position=t.pos,this.line=t.line,this.column=t.column,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack},n.Parser=function(t){this.input=t,this.look=0,this.line=1,this.column=0,this.pos=0},n.Parser.prototype.nextCharCodeRaw=function(){if(this.pos>=this.input.length)return p;var t=this.input.charCodeAt(this.pos++);return 10==t&&(this.column=0,this.line++),this.column++,t},n.Parser.prototype.nextCharCode=function(){do if(this.look=this.nextCharCodeRaw(),35==this.look)for(;10!=this.look&&this.look!=p;)this.look=this.nextCharCodeRaw();while(this.look!=p&&35==this.look)},n.Parser.prototype.skipWhite=function(){for(;this.look!=p&&t(this.look);)this.nextCharCode()},n.Parser.prototype.matchCharCode=function(t,e){if(this.look!=t)throw void 0===e&&(e="Expected '"+k(t)+"', but '"+k(this.look)+"' was found instead"),new n.ParseError(this,message);this.nextCharCode()},n.Parser.prototype.parseKey=function(){for(var t=null;this.look!=p&&e(this.look);)null===t&&(t=""),t+=k(this.look),this.nextCharCode();if(null===t)throw new n.ParseError(parser,"key expected");return t},n.Parser.prototype.parseString=function(){var t="";for(this.matchCharCode(34);34!=this.look&&this.look!=p;){if(92==this.look)switch(this.look=this.nextCharCodeRaw()){case 34:this.look=34;break;case 110:this.look=10;break;case 114:this.look=13;break;case 116:this.look=9;break;case 92:this.look=92;break;default:var e=this.nextCharCodeRaw();if(!s(e)||!s(this.look))throw new n.ParseError(this,"invalid escape sequence");this.look=16*i(this.look)+i(e)}t+=k(this.look),this.look=this.nextCharCodeRaw()}return this.matchCharCode(34),t},n.Parser.prototype.parseList=function(){this.matchCharCode(91),this.skipWhite();for(var e=[];93!=this.look;){e.push(this.parseValue());var s=t(this.look);if(this.skipWhite(),44==this.look)this.nextCharCode();else if(!s&&!t(this.look))break;this.skipWhite()}return this.matchCharCode(93),e},n.Parser.prototype.parseDict=function(){this.matchCharCode(123),this.skipWhite();var t=this.parseKeyValItems(125);return this.matchCharCode(125),t},n.Parser.prototype.parseBoolean=function(){if(84==this.look||116==this.look)return this.nextCharCode(),this.matchCharCode(114),this.matchCharCode(117),this.matchCharCode(101),!0;if(70==this.look||102==this.look)return this.nextCharCode(),this.matchCharCode(97),this.matchCharCode(108),this.matchCharCode(115),this.matchCharCode(101),!1;throw new n.ParseError(this,"boolean value expected")},n.Parser.prototype.parseNumber=function(){var t="",e=!1;(43==this.look||45==this.look)&&(t+=k(this.look),this.nextCharCode(),e=!0);var s=!1,i=!1;48==this.look&&(t+="0",this.nextCharCode(),88==this.look||120==this.look?(t+=k(this.look),this.nextCharCode(),i=!0):o(this.look)&&(s=!0));for(var a=!1,h=!1;this.look!=p&&r(this.look);)if(i||69!=this.look&&101!=this.look){if(46==this.look){if(a||i||s)throw new n.ParseError(this,"invalid number");a=!0}if(43==this.look||45==this.look)throw new n.ParseError(this,"invalid number");t+=k(this.look),this.nextCharCode()}else{if(h)throw new n.ParseError(this,"invalid number");t+="e",h=!0,this.nextCharCode(),(43==this.look||45==this.look)&&(t+=k(this.look),this.nextCharCode())}if(0==t.length)throw new n.ParseError(this,"number expected");if(i){if(h||a)throw new n.ParseError(this,"invalid hex number");return l(t,16)}if(s){if(h||a)throw new n.ParseError(this,"invalid octal number");return l(t,8)}return a||h?d(t):l(t,10)},n.Parser.prototype.parseValue=function(){switch(this.look){case 34:return this.parseString();case 91:return this.parseList();case 123:return this.parseDict();case 84:case 116:case 70:case 102:return this.parseBoolean();default:return this.parseNumber()}},n.Parser.prototype.parseKeyValItems=function(e){for(var s={};this.look!=e;){var r=this.parseKey(),o=!1;switch(t(this.look)&&(o=!0,this.skipWhite()),this.look){case 58:this.nextCharCode(),this.skipWhite();case 123:case 91:o=!0}if(!o)throw new n.ParseError(this,"missing separator");if(s[r]=this.parseValue(),44==this.look)this.nextCharCode();else if(this.look!=e&&!t(this.look))break;this.skipWhite()}return s},n.Parser.prototype.parseMessage=function(){this.nextCharCode(),this.skipWhite();var t=null;return 123==this.look?(this.nextCharCode(),this.skipWhite(),t=this.parseKeyValItems(125),this.matchCharCode(125,"unterminated message, '}' expected")):t=this.parseKeyValItems(p),t},n.load=function(t){return new n.Parser(String(t)).parseMessage()},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.hipack=n):a.hipack=n}).call(this);