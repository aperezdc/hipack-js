"use strict";(function(){function isHiPackWhitespace(ch){switch(ch){case 9:case 10:case 13:case 32:return!0;default:return!1}}function isHiPackKeyCharacter(ch){switch(ch){case 9:case 10:case 13:case 32:case 91:case 93:case 123:case 125:case 58:case 44:return!1;default:return!0}}function isHexDigit(ch){switch(ch){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 97:case 65:case 98:case 66:case 99:case 67:case 100:case 68:case 101:case 69:case 102:case 70:return!0;default:return!1}}function isNumberCharacter(ch){switch(ch){case 46:case 43:case 61:return!0;default:return isHexDigit(ch)}}function isOctalNonZeroDigit(ch){return ch>48&&56>ch}function hexDigitToInt(xdigit){switch(xdigit){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:case 65:return 10;case 98:case 66:return 11;case 99:case 67:return 12;case 100:case 68:return 13;case 101:case 69:return 14;case 102:case 70:return 15}}var root=this,previousModule=root.hipack,hipack={};hipack.noConflict=function(){return root.hipack=previousModule,hipack};var _objectKeys=Object.keys,_isArray=Array.isArray;hipack.DumpError=function(message){this.message=message,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack},hipack.Dumper=function(compact){this.indent=compact?-1:0,this.output=""},hipack.Dumper.prototype.moreIndent=function(){this.indent>=0&&this.indent++},hipack.Dumper.prototype.lessIndent=function(){this.indent>0&&this.indent--},hipack.Dumper.prototype.dumpIndent=function(){for(var indent=this.indent>=0?this.indent:0;indent--;)this.output+="  "},hipack.Dumper.prototype.dumpString=function(value){this.output+='"';for(var i=0;i<value.length;i++){var ch=value.charCodeAt(i);switch(ch){case 9:this.output+="\\t";break;case 10:this.output+="\\n";break;case 13:this.output+="\\r";break;case 34:this.output+='\\"';break;case 92:this.output+="\\\\";break;default:32>ch?(this.output+="\\",16>ch&&(this.output+="0"),this.output+=ch.toString(16).toUpperCase()):this.output+=value.charAt(i)}}this.output+='"'},hipack.Dumper.prototype.dumpBoolean=function(value){this.output+=value?"True":"False"},hipack.Dumper.prototype.dumpNumber=function(value){this.output+=value.toString()},hipack.Dumper.prototype.dumpKeyVal=function(obj,keys){for(var i=0;i<keys.length;i++){this.dumpIndent(),this.output+=keys[i];var value=obj[keys[i]];"object"!=typeof value&&(this.output+=":"),this.indent>=0&&(this.output+=" "),this.dumpValue(value),this.indent>=0?this.output+="\n":i<keys.length-1&&(this.output+=",")}},hipack.Dumper.prototype.dumpList=function(list){if(0==list.length)return void(this.output+="[]");this.output+="[",this.moreIndent(),this.indent>=0&&(this.output+="\n");for(var i=0;i<list.length;i++)this.dumpIndent(),this.dumpValue(list[i]),this.indent>=0?this.output+="\n":i<list.length-1&&(this.output+=",");this.lessIndent(),this.output+="]"},hipack.Dumper.prototype.dumpDict=function(dict){var keys=_objectKeys(dict);return 0==keys.length?void(this.output+="{}"):(this.output+="{",this.moreIndent(),this.indent>=0&&(this.output+="\n"),this.dumpKeyVal(dict,keys.sort()),this.lessIndent(),this.dumpIndent(),void(this.output+="}"))},hipack.Dumper.prototype.dumpValue=function(value){var valueType=typeof value;switch(valueType){case"number":this.dumpNumber(value);break;case"boolean":this.dumpBoolean(value);break;case"string":this.dumpString(value);break;case"object":if(null!==value){_isArray(value)?this.dumpList(value):this.dumpDict(value);break}valueType="null";default:throw new hipack.DumpError("Values of type '"+valueType+"' cannot be dumped")}},hipack.dump=function(data,compact){var dumper=new hipack.Dumper(Boolean(compact)),keys=_objectKeys(data);return dumper.dumpKeyVal(data,keys.sort()),dumper.output};var EOF=-1,_parseInt=Number.parseInt,_parseFloat=Number.parseFloat,_fromCharCode=String.fromCharCode;hipack.ParseError=function(parser,message){this.message=message,this.position=parser.pos,this.line=parser.line,this.column=parser.column,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack},hipack.Parser=function(input){this.input=input,this.look=0,this.line=1,this.column=0,this.pos=0},hipack.Parser.prototype.nextCharCodeRaw=function(){if(this.pos>=this.input.length)return EOF;var ch=this.input.charCodeAt(this.pos++);return 10==ch&&(this.column=0,this.line++),this.column++,ch},hipack.Parser.prototype.nextCharCode=function(){do if(this.look=this.nextCharCodeRaw(),35==this.look)for(;10!=this.look&&this.look!=EOF;)this.look=this.nextCharCodeRaw();while(this.look!=EOF&&35==this.look)},hipack.Parser.prototype.skipWhite=function(){for(;this.look!=EOF&&isHiPackWhitespace(this.look);)this.nextCharCode()},hipack.Parser.prototype.matchCharCode=function(ch,errmsg){if(this.look!=ch)throw void 0===errmsg&&(errmsg="Expected '"+_fromCharCode(ch)+"', but '"+_fromCharCode(this.look)+"' was found instead"),new hipack.ParseError(this,message);this.nextCharCode()},hipack.Parser.prototype.parseKey=function(){for(var key=null;this.look!=EOF&&isHiPackKeyCharacter(this.look);)null===key&&(key=""),key+=_fromCharCode(this.look),this.nextCharCode();if(null===key)throw new hipack.ParseError(parser,"key expected");return key},hipack.Parser.prototype.parseString=function(){var str="";for(this.matchCharCode(34);34!=this.look&&this.look!=EOF;){if(92==this.look)switch(this.look=this.nextCharCodeRaw()){case 34:this.look=34;break;case 110:this.look=10;break;case 114:this.look=13;break;case 116:this.look=9;break;case 92:this.look=92;break;default:var extra=this.nextCharCodeRaw();if(!isHexDigit(extra)||!isHexDigit(this.look))throw new hipack.ParseError(this,"invalid escape sequence");this.look=16*hexDigitToInt(this.look)+hexDigitToInt(extra)}str+=_fromCharCode(this.look),this.look=this.nextCharCodeRaw()}return this.matchCharCode(34),str},hipack.Parser.prototype.parseList=function(){this.matchCharCode(91),this.skipWhite();for(var list=[];93!=this.look;){list.push(this.parseValue());var gotWhitespace=isHiPackWhitespace(this.look);if(this.skipWhite(),44==this.look)this.nextCharCode();else if(!gotWhitespace&&!isHiPackWhitespace(this.look))break;this.skipWhite()}return this.matchCharCode(93),list},hipack.Parser.prototype.parseDict=function(){this.matchCharCode(123),this.skipWhite();var dict=this.parseKeyValItems(125);return this.matchCharCode(125),dict},hipack.Parser.prototype.parseBoolean=function(){if(84==this.look||116==this.look)return this.nextCharCode(),this.matchCharCode(114),this.matchCharCode(117),this.matchCharCode(101),!0;if(70==this.look||102==this.look)return this.nextCharCode(),this.matchCharCode(97),this.matchCharCode(108),this.matchCharCode(115),this.matchCharCode(101),!1;throw new hipack.ParseError(this,"boolean value expected")},hipack.Parser.prototype.parseNumber=function(){var number="",hasSign=!1;(43==this.look||45==this.look)&&(number+=_fromCharCode(this.look),this.nextCharCode(),hasSign=!0);var isOctal=!1,isHex=!1;48==this.look&&(number+="0",this.nextCharCode(),88==this.look||120==this.look?(number+=_fromCharCode(this.look),this.nextCharCode(),isHex=!0):isOctalNonZeroDigit(this.look)&&(isOctal=!0));for(var dotSeen=!1,expSeen=!1;this.look!=EOF&&isNumberCharacter(this.look);)if(isHex||69!=this.look&&101!=this.look){if(46==this.look){if(dotSeen||isHex||isOctal)throw new hipack.ParseError(this,"invalid number");dotSeen=!0}if(43==this.look||45==this.look)throw new hipack.ParseError(this,"invalid number");number+=_fromCharCode(this.look),this.nextCharCode()}else{if(expSeen)throw new hipack.ParseError(this,"invalid number");number+="e",expSeen=!0,this.nextCharCode(),(43==this.look||45==this.look)&&(number+=_fromCharCode(this.look),this.nextCharCode())}if(0==number.length)throw new hipack.ParseError(this,"number expected");if(isHex){if(expSeen||dotSeen)throw new hipack.ParseError(this,"invalid hex number");return _parseInt(number,16)}if(isOctal){if(expSeen||dotSeen)throw new hipack.ParseError(this,"invalid octal number");return _parseInt(number,8)}return dotSeen||expSeen?_parseFloat(number):_parseInt(number,10)},hipack.Parser.prototype.parseValue=function(){switch(this.look){case 34:return this.parseString();case 91:return this.parseList();case 123:return this.parseDict();case 84:case 116:case 70:case 102:return this.parseBoolean();default:return this.parseNumber()}},hipack.Parser.prototype.parseKeyValItems=function(eos){for(var dict={};this.look!=eos;){var key=this.parseKey(),gotSeparator=!1;switch(isHiPackWhitespace(this.look)&&(gotSeparator=!0,this.skipWhite()),this.look){case 58:this.nextCharCode(),this.skipWhite();case 123:case 91:gotSeparator=!0}if(!gotSeparator)throw new hipack.ParseError(this,"missing separator");if(dict[key]=this.parseValue(),44==this.look)this.nextCharCode();else if(this.look!=eos&&!isHiPackWhitespace(this.look))break;this.skipWhite()}return dict},hipack.Parser.prototype.parseMessage=function(){this.nextCharCode(),this.skipWhite();var result=null;return 123==this.look?(this.nextCharCode(),this.skipWhite(),result=this.parseKeyValItems(125),this.matchCharCode(125,"unterminated message, '}' expected")):result=this.parseKeyValItems(EOF),result},hipack.load=function(input){return new hipack.Parser(String(input)).parseMessage()},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=hipack),exports.hipack=hipack):root.hipack=hipack}).call(this);